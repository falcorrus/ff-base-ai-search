# ff-base-ai-search

Интеллектуальная система поиска по базе знаний пользователя, хранящейся в виде Markdown-файлов в локальной директории.

## Описание проекта

Этот проект представляет собой веб-приложение для интеллектуального поиска и генерации комплексных ответов на основе личной базы знаний, состоящей из Markdown заметок, хранящихся в локальной директории FF-BASE.

Проект использует векторный поиск и большие языковые модели (LLM) для предоставления быстрых и точных ответов на основе базы знаний пользователя. Недавно была восстановлена полная база данных эмбеддингов, содержащая все 276 заметок.

## Ключевые технологии

* **Бэкенд:** Python 3.9+, FastAPI
* **ИИ:** Google Gemini API (для генерации embeddings и ответов)
* **Хранилище данных:** Локальное JSON хранилище (для embeddings)
* **Фронтенд:** Vanilla JavaScript
* **Деплой:** Google Cloud Run (бэкенд), Firebase Hosting (фронтенд)

## Архитектура

1. **Синхронизация:** Получение Markdown заметок из локальной директории `FF-BASE`
2. **Генерация embeddings:** Создание и хранение векторных представлений для каждой заметки с использованием Google Gemini API
3. **Поиск:** Преобразование пользовательского запроса в embedding и поиск релевантных заметок через векторное сходство
4. **Генерация ответа:** Формирование контекста из релевантных заметок и отправка его в Google Gemini LLM для генерации комплексного ответа
5. **Поддержка русского языка:** Полная поддержка поисковых запросов на русском языке с использованием кодировки UTF-8

## Инициализация базы знаний

База данных эмбеддингов может быть инициализирована или обновлена с помощью скрипта `init_knowledge_base.py`, который обрабатывает все Markdown файлы в директории FF-BASE и генерирует для каждого соответствующие векторные представления. Файл `knowledge_base/embeddings.json` содержит векторные представления всех 276 заметок.

## Структура проекта

```
ff-base-ai-search/
├── backend/                 # Бэкенд приложение на FastAPI
│   ├── main.py             # Основной файл приложения
│   ├── requirements.txt    # Зависимости Python
│   ├── init_knowledge_base.py # Скрипт для инициализации базы знаний из FF-BASE
│   ├── start.sh            # Скрипт для запуска сервера
│   ├── Dockerfile          # Конфигурация Docker
│   └── .env.example        # Пример переменных окружения
├── frontend/               # Фронтенд приложение
│   ├── index.html          # Главная страница
│   ├── style.css           # Стили
│   └── script.js           # JavaScript код
├── FF-BASE/                # Локальное хранилище Markdown заметок (276 файлов)
├── knowledge_base/         # Локальное хранилище embeddings
│   ├── embeddings.json     # Векторные представления заметок (276 записей)
│   ├── search_log.json     # Лог поисковых запросов
│   └── embeddings_metadata.json # Метаданные для отслеживания изменений файлов
└── DOCUMENTATION.md        # Документация проекта
```

## Установка и запуск

### Бэкенд

1. Установите зависимости:
   ```bash
   pip install -r backend/requirements.txt
   ```

2. Создайте файл `.env` с необходимыми переменными окружения:
   ```bash
   cp backend/.env.example .env
   # Отредактируйте .env, добавив ваш GOOGLE_API_KEY
   ```

3. Запустите сервер:
   ```bash
   cd backend
   ./start.sh
   # Или альтернативно:
   # uvicorn main:app --reload --port 8000
   ```

### Фронтенд

1. Откройте `frontend/index.html` в браузере или запустите локальный сервер:
   ```bash
   cd frontend
   python -m http.server 3000
   ```

## API эндпоинты

* `GET /` - Проверка работы сервера
* `GET /search?query={запрос}&top_k={количество}` - Поиск по заметкам и генерация ответа
  * `query` (обязательный) - текст поискового запроса (поддерживает русский язык)
  * `top_k` (опциональный) - количество возвращаемых результатов (по умолчанию 5)
* `GET /notes-count` - Получение количества заметок в базе знаний
* `GET /update-knowledge-base-local` - Обновление базы знаний из локальной директории FF-BASE
* `GET /update-knowledge-base` - Обновление базы знаний из GitHub репозитория (требует GITHUB_PAT)

## Синхронизация базы знаний

Для удобной синхронизации между локальной базой знаний и Google Cloud Storage создан специальный скрипт:

### Быстрая синхронизация
```bash
./sync.sh
```

Этот скрипт выполняет полный цикл синхронизации:
1. Обновляет локальные эмбеддинги из директории `FF-BASE`
2. Синхронизирует обновленные эмбеддинги с Google Cloud Storage

### Расширенные команды синхронизации

```bash
# Обновить только локальные эмбеддинги
python sync_embeddings.py update-local

# Синхронизировать локальные эмбеддинги с GCS
python sync_embeddings.py sync-to-gcs

# Синхронизировать эмбеддинги из GCS в локальную директорию
python sync_embeddings.py sync-from-gcs

# Полная синхронизация (обновление + синхронизация в GCS)
python sync_embeddings.py full-sync
```

### Как это работает

1. **Локальная разработка**: Скрипт читает все Markdown заметки из директории `FF-BASE` и создает/обновляет эмбеддинги
2. **Инкрементальное обновление**: Скрипт отслеживает изменения в файлах и обновляет только измененные/новые заметки
3. **Синхронизация с облаком**: Обновленные эмбеддинги загружаются в Google Cloud Storage bucket
4. **Деплой**: При запуске в Google Cloud Run приложение загружает эмбеддинги из GCS

## Деплой

* **Бэкенд:** Google Cloud Run
* **Фронтенд:** Firebase Hosting

Подробная информация о деплое фронтенда доступна в файле [DEPLOY_FRONTEND.md](DEPLOY_FRONTEND.md)

Подробная информация о деплое бэкенда доступна в файле [backend/DEPLOY_INSTRUCTIONS.md](backend/DEPLOY_INSTRUCTIONS.md)

## Документация

Полная документация проекта доступна в файле [DOCUMENTATION.md](DOCUMENTATION.md)

## Лицензия

MIT