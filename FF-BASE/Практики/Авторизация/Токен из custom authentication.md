---
dg-publish: true
origin: https://t.me/flutterflow_rus/12427/44848
---

# Вопрос про токен из custom authentication и использовании его в апи. 

У меня на главной странице (первая после логина) внутри страницы используется listview - API call with infinite scroll (вызов использует authentication token). 
Если пользователь зашёл в приложение, а его токен истек, при вызове апи для этого списка будет неверный токен, то есть 401 ошибка. 


Вопрос: Как лучше сделать проверку на то, что токен не истёк?
Мои идеи:
Если бы это был не инфинит скролл, то я бы повесил апи на событие on page load.

При загрузке страницы можно сделать так?
Проверить current time < token expired time и если нет, то вызвать метод для обновления токена, и потом его отправлять в апи. 
Я боюсь, что он выдаст ошибку

Ответ:
Необходимо добавить обработку ошибок по коду ответа. Таким образом вы сможете вызывать обновление токена в любом случае
-=-=
Обработку на предмет 401 я конечно использую в actions. Но в этой ситуации апи вызывается же не в экшене, а в backend query. 
Тут можно на для пустого списка сделать виджет: список пуст или нажмите на кнопку обновить (и в этот момент проверить токен и запросить новый, а дальше сделать refresh query), но это не самое лучшее решение
-=-=
# Ещё 
[Custom Authentication (JSON Web Tokens) - YouTube](https://www.youtube.com/live/hnX3CvBtGvI?t=1s&pp=0gcJCX4JAYcqIYzv)
