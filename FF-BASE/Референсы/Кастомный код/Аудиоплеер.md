---
dg-publish: 
tags:
  - telegram
origin: telegram
author: "Aleksandr Stepanov"
---
# Оглавление:
[Вариант1](#Вариант1)
[Вариант 2](#Вариант%202)

# Вариант1
Дата заметки:  2025-01-19
**Forwarded from [Aleksandr Stepanov](https://t.me/Sashareklama)**

## что это
> [!NOTE] Главное отличие от встроенного - работает в WEB.

прям можно копировать и вставлять себе в приложение без лишних зависимостей. 

3 аргумента. 
1) путь к аудиофайлу. 
2) название файла
3) булевое значение типа показывать шкалу или нет (по сути ее и выключить можно) цвет можно регулировать как фона так и каждого элемента


## файл
[[code_player.txt]]
## код
```dart
import 'package:flutter/material.dart';
import 'package:just_audio/just_audio.dart';

class MusicWidget extends StatefulWidget {
  const MusicWidget({
    super.key,
    this.width,
    this.height,
    required this.audioUrl,
    required this.showProgressBar,
    required this.name, // Добавлен параметр name
  });

  final double? width;
  final double? height;
  final String audioUrl;
  final bool showProgressBar;
  final String name; // Добавлен параметр name

  @override
  State<MusicWidget> createState() => _MusicWidgetState();
}

class _MusicWidgetState extends State<MusicWidget> {
  late AudioPlayer _audioPlayer;
  bool _isPlaying = false;

  @override
  void initState() {
    super.initState();
    _audioPlayer = AudioPlayer();
    _loadAudio();
  }

  Future<void> _loadAudio() async {
    try {
      await _audioPlayer.setUrl(widget.audioUrl);
    } catch (e) {
      print("Error loading audio: $e");
    }
  }

  void _togglePlayPause() async {
    // Обновляем состояние иконки немедленно
    setState(() {
      _isPlaying = !_isPlaying;
    });

    // Останавливаем или начинаем воспроизведение
    if (_isPlaying) {
      await _audioPlayer.play();
    } else {
      await _audioPlayer.pause();
    }
  }

  @override
  void dispose() {
    _audioPlayer.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: Container(
        decoration: BoxDecoration(
          color: Color(0xFF1C0335),
          borderRadius: BorderRadius.circular(10),
        ),
        padding: const EdgeInsets.all(12),
        child: Column(
          mainAxisAlignment:
              MainAxisAlignment.center, // Центрирование по вертикали
          crossAxisAlignment:
              CrossAxisAlignment.center, // Центрирование по горизонтали
          children: [
            // Заголовок
            Text(
              widget.name, // Используем widget.name для отображения значения
              style: TextStyle(
                fontSize: 14,
                fontWeight: FontWeight.bold,
                color: Colors.white,
              ),
            ),
            const SizedBox(height: 15), // Отступ между заголовком и кнопкой

            // Визуальный переключатель Play/Pause
            IconButton(
              icon: Icon(
                _isPlaying
                    ? Icons.pause_circle_filled
                    : Icons.play_circle_filled,
                color: Colors.white, // Цвет иконки
                size: 50, // Размер иконки
              ),
              onPressed: _togglePlayPause,
            ),
            const SizedBox(height: 15), // Отступ между кнопкой и прогресс-баром

            // Если нужно показать ProgressBar
            if (widget.showProgressBar)
              StreamBuilder<Duration>(
                stream: _audioPlayer.positionStream,
                builder: (context, snapshot) {
                  final position = snapshot.data ?? Duration.zero;
                  final duration = _audioPlayer.duration ?? Duration.zero;

                  return Column(
                    children: [
                      // Прогресс-бар
                      Slider(
                        value: position.inSeconds.toDouble(),
                        max: duration.inSeconds.toDouble(),
                        onChanged: (value) {
                          _audioPlayer.seek(Duration(seconds: value.toInt()));
                        },
                        activeColor: Colors.white, // Цвет активной части
                        inactiveColor: Colors.white, // Цвет неактивной части
                      ),
                      // Текст прогресса
                      Text(
                        '${_formatDuration(position)} / ${_formatDuration(duration)}',
                        style: TextStyle(color: Colors.white),
                      ),
                    ],
                  );
                },
              ),
          ],
        ),
      ),
    );
  }

  String _formatDuration(Duration duration) {
    final minutes = duration.inMinutes.toString().padLeft(2, '0');
    final seconds = (duration.inSeconds % 60).toString().padLeft(2, '0');
    return '$minutes:$seconds';
  }
}
```

# Вариант 2
Источник: https://t.me/flutterflow_rus/55476
Делал себе такой виджет. Попробуйте его. В фоне работает, на заблокированном экране работает . https://pastebin.com/uscKYTxB
Выглядит так:
![[!files/Screenshot_2025-06-19-09-32-53-009_org.telegram.plus.png]]
