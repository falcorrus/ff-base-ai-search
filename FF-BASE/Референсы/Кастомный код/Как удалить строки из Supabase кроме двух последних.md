от [Telegram: View @flutterflow\_rus](https://t.me/flutterflow_rus/12427/52884)


Если речь идет об одной и той же таблице где нужно удалить кроме двух последних, то напишите функцию SQL  и обратитесь к ней из кастой акшен через rps и будет вам счастье. Все удалится очень быстро и просто. Можете это как Промт использовать в гит подобных чатах.

### вот sql функция
```
CREATE OR REPLACE FUNCTION delete_old_records()
RETURNS void AS $$
BEGIN
  DELETE FROM your_table_name
  WHERE id NOT IN (
    SELECT id
    FROM (
      SELECT id
      FROM your_table_name
      ORDER BY created_at DESC
      LIMIT 2
    ) AS last_two
  );
END;
$$ LANGUAGE plpgsql;
```

### Вот action в FF
```
//custom action   Future<void> deleteOldRecords() async {
final supabase = Supabase.instance.client; try {
      await supabase.rpc('delete_old_records');
    } catch (error) {
      print('Ошибка при удалении записей: $error');
    }
  }
}
```


### Описание всего этого
Этот код создает или заменяет (если такая функция уже существует) функцию в базе данных PostgreSQL под названием `delete_old_records`. Давайте разберем, что делает каждый элемент этой функции:

- **`CREATE OR REPLACE FUNCTION delete_old_records()`**:
    
    - `CREATE OR REPLACE FUNCTION`: Эта команда создает новую функцию в базе данных. Если функция с именем `delete_old_records` уже существует, она будет заменена новой версией. Это удобно при разработке и внесении изменений в функцию.
    - `delete_old_records()`: Это имя создаваемой функции. После создания вы сможете вызывать эту функцию для выполнения ее действий.
- **`RETURNS void AS $$`**:
    
    - `RETURNS void`: Это указывает, что функция не возвращает никакого значения после своего выполнения.
    - `AS $$`: Это означает, что тело функции будет заключено между двумя символами доллара (`$$`). Это используется для определения строкового литерала, который может содержать одинарные кавычки и другие специальные символы без необходимости их экранирования.
- **`BEGIN ... END;`**:
    
    - `BEGIN`: Это начало блока кода, который будет выполняться при вызове функции.
    - `END;`: Это конец блока кода функции.
- **`DELETE FROM your_table_name`**:
    
    - `DELETE FROM`: Это SQL-команда для удаления записей из таблицы.
    - `your_table_name`: **Важно!** Вам нужно заменить `your_table_name` на фактическое имя таблицы, из которой вы хотите удалять старые записи.
- **`WHERE id NOT IN (...)`**:
    
    - `WHERE`: Это условие, которое определяет, какие записи будут удалены.
    - `id NOT IN (...)`: Это означает, что будут удалены все записи, чей столбец `id` не содержится в списке значений, возвращаемом подзапросом, заключенным в скобки.
- **`( ... ) AS last_two`**:
    
    - Это подзапрос, который выбирает определенные `id` из таблицы.
    - `AS last_two`: Это присваивает псевдоним `last_two` результирующей таблице подзапроса. Хотя в данном конкретном случае этот псевдоним не используется во внешнем запросе `DELETE`, он обязателен при использовании `ORDER BY` и `LIMIT` в некоторых контекстах подзапросов.
- **`SELECT id FROM your_table_name ORDER BY created_at DESC LIMIT 2`**:
    
    - `SELECT id`: Этот внутренний подзапрос выбирает значения столбца `id`.
    - `FROM your_table_name`: Он выбирает данные из той же таблицы, что и внешний запрос `DELETE` (`your_table_name`).
    - `ORDER BY created_at DESC`: Это сортирует все записи в таблице по столбцу `created_at` в убывающем порядке (от самых новых к самым старым). Предполагается, что в вашей таблице есть столбец `created_at`, который хранит время создания записи.
    - `LIMIT 2`: Это ограничивает результат выборки только двумя первыми записями после сортировки, то есть двумя самыми новыми записями на основе времени `created_at`.
- **`$$ LANGUAGE plpgsql;`**:
    
    - `LANGUAGE plpgsql`: Это указывает, что функция написана на процедурном языке PL/pgSQL, который является расширением SQL, специфичным для PostgreSQL и позволяющим писать более сложную логику внутри функций и хранимых процедур.

**Таким образом, эта функция `delete_old_records()` делает следующее:**

1. Она находит две самые последние записи в таблице `your_table_name` на основе значений в столбце `created_at`.
2. Затем она удаляет _все_ записи из таблицы `your_table_name`, чьи значения в столбце `id` не совпадают со значениями `id` этих двух самых последних записей.

**Другими словами, эта функция сохраняет только две самые новые записи в вашей таблице `your_table_name` и удаляет все остальные.**

**Важно не забыть заменить `your_table_name` на имя вашей фактической таблицы!** Также убедитесь, что в вашей таблице есть столбец с именем `created_at` (типа timestamp или date) и столбец `id` (являющийся первичным ключом или уникальным идентификатором записей).

# первый раздел
## Второй раздел
### Третий уровень