# Как работает поиск в системе

## Процесс поиска

### 1. Получение запроса
Пользователь отправляет поисковый запрос через endpoint `GET /search?query={query}`

### 2. Генерация эмбеддинга запроса
- Используется Google Gemini API (`models/embedding-001`)
- Создается векторное представление (эмбеддинг) для поискового запроса
- Эмбеддинг имеет размерность 768

### 3. Векторный поиск
- Загружаются все существующие эмбеддинги заметок из `knowledge_base/embeddings.json`
- Выполняется сравнение эмбеддинга запроса с эмбеддингами всех заметок
- Используется косинусное сходство для определения релевантности
- Возвращаются топ-N наиболее похожих документов (по умолчанию 5)

### 4. Генерация ответа
- Формируется контекст из содержимого релевантных заметок
- Контекст и оригинальный запрос отправляются в Google Gemini LLM (`gemini-1.5-flash`)
- Получается сгенерированный ответ, основанный на содержимом заметок

### 5. Логирование
- Поисковый запрос с timestamp записывается в `knowledge_base/search_log.json`

## Пример работы

**Запрос**: "подробные описания"

**Найденные документы**:
1. Дизайн и пользовательский интерфейс/Expandable button-Раскрывающееся меню.md
2. Flutterflow/Политика обработки персональных данных (пример).md
3. Flutterflow/Общая информация о Базе знаний.md
4. video/Графовые базы данных в N8N как альтернатива векторам.md
5. Интеграции и Внешние сервисы/Платежи и денежные вопросы/Прием оплаты в России.md

**Сгенерированный ответ**:
Система находит подробные описания различных тем, включая:
- Анимированное меню с кнопкой
- Политику обработки персональных данных
- Историю создания базы знаний
- Графовые базы данных как альтернативу векторам
- Прием платежей в России

## Преимущества

1. **Семантический поиск**: Находит не просто ключевые слова, а похожие по смыслу заметки
2. **Контекстуальные ответы**: Генерирует ответы на основе реального содержимого заметок
3. **Эффективность**: Благодаря инкрементальным обновлениям, база всегда актуальна без лишних затрат
4. **Масштабируемость**: Может работать с тысячами заметок
5. **Скорость**: Поиск происходит практически мгновенно, так как все эмбеддинги хранятся локально

## Технические детали

- **Хранение**: Эмбеддинги хранятся в локальном JSON файле и загружаются в память при запуске
- **Алгоритм**: Косинусное сходство для сравнения векторов
- **API**: Google Gemini для генерации эмбеддингов и ответов
- **Инкрементальные обновления**: Только измененные файлы перегенерируются